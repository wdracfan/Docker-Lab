# Лабораторная работа. Docker

Данный репозиторий создан в рамках выполнения [лабораторной работы](https://github.com/ilya2108/HSE-Lab-Docker/blob/main/README.md) по курсу "Введение в облачные технологии". 

**Нижеследующая инструкция составлена с учётом особенностей Windows и работы Docker на Windows. Полная применимость её к другим операционным системам не гарантируется.**

## Пререквизиты

- запустить Docker Desktop и дождаться статуса "Engine running" в левом нижнем углу
- клонировать этот репозиторий (ввести в командную строку `git clone https://github.com/wdracfan/Docker-Lab.git dockerlab` или скачать как zip-архив [здесь](https://github.com/wdracfan/Docker-Lab/archive/refs/heads/main.zip))

## Инструкция по развёртыванию

В командной строке перейдите в директорию, куда был клонирован репозиторий (например, если вы клонировали репозиторий с помощью git-команды, то необходимо ввести `cd dockerlab`).

Введите в командной строке следующую команду:
```
docker-compose up -d --build
```
Вы должны увидеть примерно следующее:

![image](https://user-images.githubusercontent.com/121407222/210179905-23f89721-fd1a-4bff-93bc-d98963bdcd4b.png)

Откройте браузер и в адресной строке введите:
```
localhost
```
или, что то же самое:
```
127.0.0.1
```

Должно открыться окно примерно такого вида:

![image](https://user-images.githubusercontent.com/121407222/209570731-3f9fdf0e-3ea3-469d-afd6-a53763a7d068.png)

Для авторизации с правами администратора в поле Username и в поле Password введите `admin`. Для авторизации без прав администратора в поле Username введите `user`, а в поле Password - `admin`.

После этого откроется список Jupyter-ноутбуков, расположенных в каталоге `/home` той директории, куда вы клонировали содержимое репозитория. Изначально там лежит только файл `helloworld.ipynb`:

![image](https://user-images.githubusercontent.com/121407222/209568826-b6e9dd17-f962-4b8f-9e85-ad100b323fe9.png)

Нажмите на него, чтобы открыть:

![image](https://user-images.githubusercontent.com/121407222/209570992-77c143bb-1131-4d85-afcc-d5bf448c8e68.png)

Чтобы свернуть JupyterHub, нажмите на кнопку `Control Panel` в правом верхнем углу, затем на верхней панели выберите `Admin` и нажмите на большую красную кнопку `Shutdown Hub` (внешне ничего не произойдёт, но если вы попробуете перезагрузить страницу, то получите ошибку вроде "Не удаётся получить доступ к сайту"). 

Свернуть JupyterHub таким образом можно **только с правами администратора**. Если вы авторизовались с логином-паролем `user`-`admin`, нажмите на кнопку `Logout` в правом верхнем углу, авторизуйтесь с логином-паролем `admin`-`admin` и проделайте вышеуказанные действия.

Другой способ завершить работу развёрнутого JupyterHub - это остановить контейнер. Для этого в командную строку введите следующую команду:
```
docker stop jupyterhub
```
## Бонусное задание

В рамках выполнения бонусного задания реализована возможность загрузки Jupyter-ноутбуков из указанной директории на вашем устройстве в указанную директорию в JupyterHub.

Для этого откройте файл `.env`. Вы увидите там следующее:
```
NOTEBOOKS_FROM="./home"
HUB_PATH=""
```

Таковы заданные по умолчанию значения переменных среды `NOTEBOOKS_FROM` (откуда брать ноутбуки на устройстве) и `HUB_PATH` (куда их загружать в JupyterHub). Чтобы указать пользовательские значения, поменяйте соответствующие директории в кавычках. Например, если ваши ноутбуки расположены в директории `/home/hse/homework` (где `/home` расположена на одном уровне с Dockerfile), а в JupyterHub вы их хотите видеть по адресу `/subdir/my_notebooks`, то файл `.env` должен выглядеть следующим образом:
```
NOTEBOOKS_FROM="./home/hse/homework"
HUB_PATH="/subdir/my_notebooks"
```

**Есть вы указываете относительный путь к директории `NOTEBOOKS_FROM`, то он непременно должен начинаться с точки!**

После этого сохраните файл `.env` и проделайте все действия, указанные в инструкции по развёртыванию выше.

Чтобы открыть Jupyter-ноутбуки, загруженные из указанной вами директории, после авторизации вам будет необходимо пройти по тому адресу, который вы указали в `HUB_PATH`: в открывшемся списке выбрать папку `subdir`, затем папку `my_notebooks` - и там вы увидите содержимое `/home/hse/homework`.

## Комментарии по условию

На Q&A-сессии было рекомендовано включить в Readme-файл раздел с описанием моего видения задания лабораторной работы. Если попробовать изложить его примитивно, то получится следующее.

В рамках основного задания: сделать так, чтобы при вводе `localhost` в адресную строку браузера открывалось *нечто* (далее - JupyterHub), где можно авторизоваться с логином-паролем `admin`-`admin`, после чего откроется список Jupyter-ноутбуков из локальной директории `/home`, расположенной на одном уровне с Dockerfile. При этом все изменения в этой директории, сделанные в ходе работы в JupyterHub, должны отражаться и в локальной директории `/home` (и, соответственно, наоборот).

В рамках бонусного задания: сделать так, чтобы Jupyter-ноутбуки "копировались" не обязательно из локальной директории `/home` в корневую директорию JupyterHub (то есть ту, которая открывается после авторизации), а из той локальной директории, которую укажет пользователь, в ту директорию JupyterHub, которую укажет пользователь. Причём, указывая эти директории, пользователь не должен трогать ни Dockerfile, ни файл docker-compose.

## Комментарии по реализации

С образом `jupyterhub/jupyterhub` возникли некоторые сложности, поэтому, последовав встретившемуся мне в интернете совету, в качестве базового образа я взял `jupyterhub/jupyterhub-demo`.

Внутренний порт, на котором разворачивается JupyterHub, изменён с 8000 (по умолчанию) на 80 - просто потому что могу и чтобы было. Внешний порт 80 позволяет в адресной строке браузера не прописывать явно `:80`, так как является портом HTTP по умолчанию.

Используется dummy-аутентификация. Единый пароль - `admin`. Логин для авторизации с правами администратора - `admin`, без прав администратора - `user`. Все остальные комбинации логина-пароля приведут к ошибке "Invalid username or password".

В качестве spawner'а используется SimpleLocalProcessSpawner. Почему именно он? К нему меня привёл метод проб, ошибок и блуждания по интернету.

В развёрнутом JupyterHub "корневой" директорией (той, которая открывается после авторизации) является `/home` (это произвольно выбранное название; не путать с локальной директорией `/home`) вне зависимости от того, что написано в файле `.env`. Путь, указанный в аргументе `HUB_PATH`, будет добавлен к `/home`, но после авторизации в JupyterHub по этому пути нужно будет проследовать самостоятельно из открывшейся директории `/home`.

## Контакты

В случае возникновения при проверке каких-либо вопросов или претензий можно написать мне в Telegram: [@vvliapd](https://t.me/vvliapd).
